---
layout: post
title: "[Kafka] Kafka는 왜 빨라요?"
date: 2023-09-03 18:35:00 +09:00
categories: [Kafka]
tags: [Kafka]
comments: true
---

### 카프카의 네트워크

[Apache Kafka 공식문서](https://kafka.apache.org/protocol#protocol_network)

Kafka는 TCP를 통해 **바이너리 프로토콜**을 사용합니다.  

서버는 단일 TCP 연결에서 **요청**이 전송된 **순서대로 처리**되고 **응답**도 **해당 순서대로 반환되도록 보장**합니다.

브로커의 요청 처리에서는 이 순서를 보장하기 위해 연결당 **단일 진행 중인 요청**만 **허용**합니다.

클라이언트는 **Non-blocking I/O**를 사용하여 요청 파이프라인을 구현하고 더 높은 처리량을 뽑아낼 수 있습니다.

카프카가 Non-blocking을 사용한다는 말은, 클라이언트가 응답을 대기하지 않더라도 기본 OS 소켓 버퍼에 버퍼링되므로 클라이언트는 계속해서 요청을 보낼 수 있습니다.

추가로 브로커는 하나의 TCP 연결 안에서 응답은 요청의 순서대로 반환합니다.

따라서 브로커는 연결 별로 요청을 순서대로 하나씩 처리합니다. 그리고 브로커는 요청의 최대 크기를 설정할 수 있으며, 이 크기를 넘는 요청이 들어오는 경우 소켓 연결은 끊어집니다.

### 바이너리 프로토콜

바이너리 프로토콜은 값을 바이트로써 사용하는 프로토콜입니다.

이는 값을 사람이 읽기 쉬운(Human-readable) 문자로 사용하는 텍스트 프로토콜(Text Protocol)과 반대의 방법입니다.

값을 바이트로 표현하기 때문에 사람이 직접 읽기엔 어렵지만, 컴퓨터 입장에선 별도의 인코딩/디코딩이 필요 없으므로 빠르게 읽고 처리할 수 있다는 장점이 있습니다.

바이너리 프로토콜을 이용하기 위해 모든 API에 대한 요청과 응답 메시지의 바이트 구성을 정의했습니다. 그래서 모든 메시지는 특정한 바이트 사이즈를 가집니다.

또한 [프로토콜 기본 타입(Protocol Primitive Type)](https://kafka.apache.org/protocol#protocol_types)으로 지정된 값들로 API 요청/응답 메시지의 내용을 표현합니다.
